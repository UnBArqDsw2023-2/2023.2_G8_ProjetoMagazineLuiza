# 4.2. Módulo Reutilização de Software

**Foco_02:** Reutilização de Software.

Entrega Mínima: Exemplo de Reutilização, evidenciando parte conceitual (se possível, com modelagem) e código. Além de outras situações, os Padrões de Projeto são candidatos a serem revelados aqui (problema, solução, modelagem e código, evidenciando aspectos de reutilização).

Apresentação (em sala) conferindo reflexões sobre reutilização de software no escopo da aplicação, com: (i) rastro claro aos membros participantes (MOSTRAR QUADRO DE PARTICIPAÇÕES & COMMITS); (ii) justificativas & senso crítico sobre reutilização de software; (iii) breve análise do exemplo (parte conceitual & código) no escopo da aplicação, e (iv) comentários gerais sobre o trabalho em equipe. Tempo da Apresentação: +/- 10min. Recomendação: Apresentar diretamente via Wiki ou GitPages do Projeto.

A Wiki ou GitPages do Projeto deve conter um tópico dedicado ao Módulo Reutilização de Software, com exemplo de reutilização de software (parte conceitual & código), histórico de versões, referências, e demais detalhamentos gerados pela equipe nesse escopo.

Demais orientações disponíveis nas Diretrizes (vide Moodle).

## Reutilização no frontend

### Caso 1 - Utilização de singleton

O Singleton é um padrão de projeto criacional que permite garantir que uma classe tenha apenas uma instância, enquanto provê um ponto de acesso global para essa instância.

O problema identificado no frontend para utilização desse padrão de projeto é a necessidade de ter um ponto de acesso global para uma determinada instância. A criticidade desse problema é aumentada em situações onde as alterações de uma instância devem ser relevantes para usos futuros.

O caso de demonstração do aplicativo é sobre o _sharedRepository_. Essa classe é uma das camadas identificadas no diagrama de pacotes, sendo responsável por formatar os dados vindos de um ambiente externo para o domínio da aplicação. Dois casos de uso necessitam dessa referência, nesse cenário poderíamos instanciar duas vezes essa classe, contudo ao escalar para mais casos de uso começamos a ter problemas como uso de memória desnecessário e afins.

Para resolver isso, criamos uma referência global para uma instância do _sharedRepository_. Abaixo é possível entender melhor como isso foi implementado.

```
import 'package:dartz/dartz.dart';

import '../../../core/failures.dart';
import '../entities/produto.dart';
import '../repositories/shared_repository.dart';

abstract class GetProducts {
  Future<Either<Failure, List<Produto>>> call();
}

class GetProductsImpl implements GetProducts {
  final SharedRepository repository;

  GetProductsImpl({
    required this.repository,
  });

  @override
  Future<Either<Failure, List<Produto>>> call() async {
    return await repository.getProducts();
  }
}

```

<p align='center'>
Caso 1 -Trecho de Código 1: Caso de uso que precisa da classe *ShareRepository* para sua execução. Autor: [Mauricio Machado](https://github.com/MauricioMachadoFF).
</p>

```
import 'package:frontend_example/shared/data/repositories/shared_repository_impl.dart';
import 'package:frontend_example/shared/domain/repositories/shared_repository.dart';
import 'package:frontend_example/shared/domain/usecases/get_products.dart';
import 'package:frontend_example/shared/domain/usecases/get_profile_information.dart';
import 'package:get_it/get_it.dart';

class SharedInjectionContainer {
  void inject(GetIt serviceLocator) {
    serviceLocator.registerFactory<SharedRepository>(
      () => SharedRepositoryImpl(),
    );
    serviceLocator.registerFactory<GetProducts>(
      () => GetProductsImpl(
        //Reutilização de software: utilização de singleton para referenciar uma instância do sharedRepository
        repository: serviceLocator.get(),
      ),
    );
    serviceLocator.registerFactory<GetProfileInformation>(
      //Reutilização de software: utilização de singleton para referenciar uma instância do sharedRepository
      () => GetProfileInformationImpl(
        sharedRepository: serviceLocator.get(),
      ),
    );
  }
}

```

<p align='center'>
Caso 1 -Trecho de Código 2: Classe para injeção de arquivos relevantes para a pasta **shared**. Autor: [Mauricio Machado](https://github.com/MauricioMachadoFF).
</p>

```
import 'package:frontend_example/shared/shared_injection_container.dart';
import 'package:get_it/get_it.dart';

final GetIt getIt = GetIt.I;

void configureDependecies() {
  SharedInjectionContainer().inject(getIt);
}

```

<p align='center'>
Caso 1 - Trecho de Código 3: Abordagem de injeção global da aplicação. Autor: [Mauricio Machado](https://github.com/MauricioMachadoFF).
</p>

Esse exemplo, apresenta uma forma de disponibilizar uma referência global para uma instância, tornando menos custoso em caso de possuir diversos objetos que precisem do _SharedRepository_.

### Caso 2 - Abstract factory em design system

Uma aplicação que apresente diversos temas pode enfrentear um problema em otimizar a reconstrução de seus componentes conforme o usuário realizar a troca de tema selecionado.

Para resolver esse problema, pode-se usar o padrão de projeto abstract factory. Ele é um padrão de projeto criacional que permite que você produza famílias de objetos relacionados sem ter que especificar suas classes concretas.

A fim de exemplificar esse cenário o grupo criou uma classe abstrata _DesignSystemFactory_ que possui dois métodos para criação de componentes: _createButton_ e _createReviewCard_ (cada método cria um componente próprio).

Essa abstração possui duas implementações: _LightThemeFactory_ e _DarkThemeFactory_, onde cada uma possui sua própria implementação de cada componente. Isso permite que ao trocar de família, toda a árvore de componentes associada a um design_system seja atualizada para o novo tema.

Para trazer ainda mais para nosso contexto de avaliação de produtos, também usamos o Abstract Factory para a criação dos cards de avaliação de produtos. Nós criamos a classe abstrata _DesignSystemFactoryCard_ que possui um método para a criação do card. Também criamos 3 implementações, _DetailedRatingCard_, que exibe uma nota de 1 a 5 e uma descrição, _RecommendationCard_, que informa se o usuário recomendou o produto ou não e SimpleRatingCard, que apenas dá uma nota de 1 a 5 para o produto.

#### Modo dark e light

Abaixo podemos ver o código de implementação e um exemplo de execução.

```
import 'package:flutter/material.dart';

// Abstract factory for the design system
abstract class DesignSystemFactory {
  Button createButton();
  ReviewCard createReviewCard();
}

// Abstract product: Button
abstract class Button {
  Widget render();
}

// Abstract product: ReviewCard
abstract class ReviewCard {
  Widget render();
}

```

<p align='center'>
Caso 2 - Trecho de Código 1: Classe Abstrata DesignSystemFactory. Autor: [Mauricio Machado](https://github.com/MauricioMachadoFF).
</p>

```
// Light theme factory implementation
import 'package:flutter/material.dart';

import 'design_system_factory.dart';

class LightThemeFactory implements DesignSystemFactory {
  @override
  Button createButton() {
    return LightButton();
  }

  @override
  ReviewCard createReviewCard() {
    return LightReviewCard();
  }
}

// Light theme button implementation
class LightButton implements Button {
  @override
  Widget render() {
    return ElevatedButton(
      style: ElevatedButton.styleFrom(backgroundColor: Colors.blue),
      onPressed: () {},
      child: const Text('Light Button'),
    );
  }
}

// Light theme review card implementation
class LightReviewCard implements ReviewCard {
  @override
  Widget render() {
    return const Card(
      color: Colors.yellowAccent,
      child: Padding(
        padding: EdgeInsets.all(8.0),
        child: Text('Light Review Card'),
      ),
    );
  }
}

```

<p align='center'>
Caso 2 - Trecho de Código 2: Classe Concreta que implementa DesignSystemFactory, LightThemeFactory. Autor: [Mauricio Machado](https://github.com/MauricioMachadoFF).
</p>

```
// Dark theme factory implementation
import 'package:flutter/material.dart';

import 'design_system_factory.dart';

class DarkThemeFactory implements DesignSystemFactory {
  @override
  Button createButton() {
    return DarkButton();
  }

  @override
  ReviewCard createReviewCard() {
    return DarkReviewCard();
  }
}

// Dark theme button implementation
class DarkButton implements Button {
  @override
  Widget render() {
    return ElevatedButton(
      style: ElevatedButton.styleFrom(backgroundColor: Colors.black),
      onPressed: () {},
      child: const Text('Dark Button'),
    );
  }
}

// Dark theme review card implementation
class DarkReviewCard implements ReviewCard {
  @override
  Widget render() {
    return const Card(
      color: Colors.grey,
      child: Padding(
        padding: const EdgeInsets.all(8.0),
        child: Text('Dark Review Card'),
      ),
    );
  }
}

```

<p align='center'>
Caso 2 - Trecho de Código 3: Classe Concreta que implementa DesignSystemFactory, DarkThemeFactory. Autor: [Mauricio Machado](https://github.com/MauricioMachadoFF).
</p>

```
import 'package:design_system/design_system.dart';
import 'package:flutter/material.dart';

class ExamplePage extends StatefulWidget {
  const ExamplePage({Key? key}) : super(key: key);

  @override
  State<ExamplePage> createState() => _ExamplePageState();
}

class _ExamplePageState extends State<ExamplePage> {
  String selectedTheme = 'light';
  DesignSystemFactory factory = LightThemeFactory();

  String get themeFactory {
    if (factory is LightThemeFactory) {
      return 'Tema light';
    } else if (factory is DarkThemeFactory) {
      return 'Tema escuro';
    }
    return 'Sem tema definido';
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: SafeArea(
        child: Align(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              buildThemeSelector(),
              const Text('Botão na família 1'),
              factory.createButton().render(),
              const SizedBox(
                height: 32,
              ),
              factory.createReviewCard().render(),
              const SizedBox(
                height: 32,
              ),
            ],
          ),
        ),
      ),
    );
  }

  Widget buildThemeSelector() {
    return Row(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        const Text('Selecione o tema:'),
        const SizedBox(width: 16),
        DropdownButton<String>(
          value: selectedTheme,
          items: ['light', 'dark']
              .map((theme) => DropdownMenuItem(
                    value: theme,
                    child: Text(theme),
                  ))
              .toList(),
          onChanged: (String? value) {
            if (value != null) {
              if (value == 'light') {
                setState(() {
                  selectedTheme = value;
                  factory = LightThemeFactory();
                });
              } else if (value == 'dark') {
                setState(() {
                  selectedTheme = value;
                  factory = DarkThemeFactory();
                });
              }
            }
          },
        ),
      ],
    );
  }
}

```

<p align='center'>
Caso 2 - Trecho de Código 4: simulação de rápida troca de fábricas e atualização de componentes. Autor: [Mauricio Machado](https://github.com/MauricioMachadoFF).
</p>

#### Exemplo de execução

<div align = "center"><img src="https://raw.githubusercontent.com/UnBArqDsw2023-2/2023.2_G8_ProjetoMagazineLuiza/main/docs/Assets/ArquiteturaReutilizacao/ReutilizacaoDeSoftware/frontend_caso_2_abs_fac_pg1.png" alt="Figura 1: Exemplo com tema light selecionado."></div>

<p align='center'>
Figura 1: Exemplo com tema light selecionado. Autor: [Mauricio Machado](https://github.com/MauricioMachadoFF).
</p>

<div align = "center"><img src="https://raw.githubusercontent.com/UnBArqDsw2023-2/2023.2_G8_ProjetoMagazineLuiza/main/docs/Assets/ArquiteturaReutilizacao/ReutilizacaoDeSoftware/frontend_caso_2_abs_fac_pg2.png" alt="Figura 2: Selecionando tema escuro."></div>

<p align='center'>
Figura 2: Selecionando tema escuro. Autor: [Mauricio Machado](https://github.com/MauricioMachadoFF).
</p>

<div align = "center"><img src="https://raw.githubusercontent.com/UnBArqDsw2023-2/2023.2_G8_ProjetoMagazineLuiza/main/docs/Assets/ArquiteturaReutilizacao/ReutilizacaoDeSoftware/frontend_caso_2_abs_fac_pg3.png" alt="Figura 3: Alteração dos componentes ao trocar de tema selecionado."></div>

<p align='center'>
Figura 3: Alteração dos componentes ao trocar de tema selecionado. Autor: [Mauricio Machado](https://github.com/MauricioMachadoFF).
</p>

#### Cards de avaliação

Abaixo podemos ver a implementação:

```
abstract class DesignSystemFactoryCard {
  RatingCard createRatingCard();
}

// Abstract product: Card
abstract class RatingCard {
  Widget render();
}
```
<p align='center'>
Classe Abstrata DesignSystemFactoryCard.
</p>

```
class DetailedRatingCard implements RatingCard {
  final int rating;
  final String description;

  DetailedRatingCard(this.rating, this.description);

  @override
  Widget render() {
    return Card(
      child: Padding(
        padding: const EdgeInsets.all(8.0),
        child: Column(
          children: [
            Text('Rating: $rating'),
            Text('Description: $description'),
          ],
        ),
      ),
    );
  }
}
```
<p align='center'>
Classe Concreta que implementa DesignSystemFactoryCard, DetailedRatingCard
</p>

```
class RecommendationCard implements RatingCard {
  final bool recommend;

  RecommendationCard(this.recommend);

  @override
  Widget render() {
    return Card(
      child: Padding(
        padding: const EdgeInsets.all(8.0),
        child: Text('Recommend: ${recommend ? "Yes" : "No"}'),
      ),
    );
  }
}

```
<p align='center'>
Classe Concreta que implementa DesignSystemFactoryCard, RecommendationCard
</p>

```
class SimpleRatingCard implements RatingCard {
  final int rating;

  SimpleRatingCard(this.rating);

  @override
  Widget render() {
    return Card(
      child: Padding(
        padding: const EdgeInsets.all(8.0),
        child: Text('Rating: $rating'),
      ),
    );
  }
}
```
<p align='center'>
Classe Concreta que implementa DesignSystemFactoryCard, SimpleRatingCard
</p>

#### Exemplo de execução

<div align = "center"><img src="https://raw.githubusercontent.com/UnBArqDsw2023-2/2023.2_G8_ProjetoMagazineLuiza/main/docs/Assets/ArquiteturaReutilizacao/ReutilizacaoDeSoftware/recomendationCard.png" alt="Figura 4"></div>

<p align='center'>
Figura 4: Card de recomendação
</p>

<div align = "center"><img src="https://raw.githubusercontent.com/UnBArqDsw2023-2/2023.2_G8_ProjetoMagazineLuiza/main/docs/Assets/ArquiteturaReutilizacao/ReutilizacaoDeSoftware/detailedCard.png" alt="Figura 4"></div>

<p align='center'>
Figura 5: Card detalhado
</p>

<div align = "center"><img src="https://raw.githubusercontent.com/UnBArqDsw2023-2/2023.2_G8_ProjetoMagazineLuiza/main/docs/Assets/ArquiteturaReutilizacao/ReutilizacaoDeSoftware/simpleCard.png" alt="Figura 4"></div>

<p align='center'>
Figura 6: Card simples
</p>


## 4. Conclusão

<p align='justify'>
O documento apresenta exemplos de utilização de diversos elementos, e a estrutura do documento em si é um exemplo de aplicação do padrão desejado para os documentos. Deve-se seguir o aqui exposto para op exercício de boas pŕaticas de documentação.
</p>

#### Modo Cards de avaliação

## 5. Referências

> SERRANO, Milene. GOFs criacionais. Disponível em: <https://aprender3.unb.br/pluginfile.php/2649446/mod_label/intro/Arquitetura%20e%20Desenho%20de%20Software%20-%20Aula%20GoFs%20Criacionais%20-%20Profa.%20Milene.pdf>. Acesso em: 27 de Novembro de 2023.

> Singleton. Refactoring guru, 2014. Disponível em: <https://refactoring.guru/pt-br/design-patterns/singleton>. Acesso em: 27 de Novembro de 2023.

## 6. Histórico de Versões

|    Data    | Versão |                                                Descrição                                                |                         Autor(a)                         | Revisor(a) |
| :--------: | :----: | :-----------------------------------------------------------------------------------------------------: | :------------------------------------------------------: | :--------: |
| 27/11/2023 |  1.0   | Adição de dois casos de reutilização de software no contexto de frontend (singleton e abstract factory) | [Mauricio Machado](https://github.com/MauricioMachadoFF) |     [Natan Santana](https://github.com/Neitan2001)     |
| 29/11/2023 |  2.0   | Exemplos de abstract factory | [Clara Ribeiro](https://github.com/clara-ribeiro) e [Iago de Souza](https://github.com/iagoscm) | 
